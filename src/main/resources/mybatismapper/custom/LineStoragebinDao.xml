<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.uspring.sdsmesplus.dao.LineStoragebinDao">
	<select id="findBinByType" resultMap="com.uspring.sdsmesplus.dao.generate.SysStoragebinPODao.BaseResultMap">
		select 
			bin.bin_id, 
			bin.warehouse_num, 
			bin.warehouse_loc, 
			bin.storage_type, 
			storage_type_desc, 
			work_station, 
    		work_station_desc, 
    		entitled_part, 
    		bin_area, is_active, 
    		bin.create_time, 
    		bin.update_time
		from 
			sys_storagebin bin
			left join sys_line_storagebin lbin on lbin.bin_id = bin.bin_id
		where 
			lbin.line_id = #{line_id}
			and lbin.storage_type = #{storage_type}
	</select>
	
	<resultMap id="LineStoragebinMap" type="com.uspring.sdsmesplus.entity.vo.LineStoragebinVO">
    	<id column="linbin_id" jdbcType="INTEGER" property="linbinId" />
    	<result column="line_id" jdbcType="INTEGER" property="lineId" />
    	<result column="bin_id" jdbcType="INTEGER" property="binId" />
        <result column="bin_code" jdbcType="VARCHAR" property="binCode" />
        <result column="storage_type" jdbcType="VARCHAR" property="storageType" />
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    	<collection property="lines" ofType="com.uspring.sdsmesplus.entity.vo.LineVO">
        	<id column="line_id" jdbcType="INTEGER" property="lineId" />
    		<result column="line_name" jdbcType="VARCHAR" property="lineName" />
    		<result column="vsm_id" jdbcType="INTEGER" property="vsmId" />
    		<result column="shop_id" jdbcType="INTEGER" property="shopId" />
    		<result column="fc_id" jdbcType="INTEGER" property="fcId" />
    		<result column="line_type" jdbcType="VARCHAR" property="lineType" />
    		<result column="line_barcode_id" jdbcType="VARCHAR" property="lineBarcodeId" />
    		<result column="line_barcode_code" jdbcType="VARCHAR" property="lineBarcodeCode" />
   			<result column="line_sap_code" jdbcType="VARCHAR" property="lineSapCode" />
    		<result column="line_mpmlink_code" jdbcType="VARCHAR" property="lineMpmlinkCode" />
    		<result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    		<result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    		<collection property="factorys" ofType="com.uspring.sdsmesplus.entity.po.SysFactoryPO">
    			<id column="fc_id" jdbcType="INTEGER" property="fcId" />
    			<result column="fc_code" jdbcType="VARCHAR" property="fcCode" />
    			<result column="fc_name" jdbcType="VARCHAR" property="fcName" />
   				<result column="fc_address" jdbcType="VARCHAR" property="fcAddress" />
    			<result column="fc_domain" jdbcType="VARCHAR" property="fcDomain" />
    			<result column="fc_sds_id" jdbcType="VARCHAR" property="fcSdsId" />	
    		</collection>
    	</collection>
  	</resultMap>
  	
  	<select id="selectLineStoragebins" resultMap="LineStoragebinMap">
  		select s.linbin_id,s.line_id,s.bin_id,s.bin_code,s.storage_type,s.create_time,
  			l.line_name,fc_name from sys_line_storagebin s 
  		left join sys_line l 
  			on l.line_id=s.line_id
		left join sys_factory f
			on l.fc_id=f.fc_id
  		where 1=1
  		<if test="lineId !='' and lineId != null">
			and l.line_id = #{lineId}
		</if>
		<if test="factoryId !='' and factoryId != null">
			and l.fc_id = #{factoryId}
		</if>
  	</select>
  	
</mapper>