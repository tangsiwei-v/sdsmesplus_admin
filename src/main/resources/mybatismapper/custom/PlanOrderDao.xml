<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.uspring.sdsmesplus.dao.PlanOrderDao">
	<resultMap id="BaseResultMapTwo" type="com.uspring.sdsmesplus.entity.po.PlanOrderPO">
		<id column="po_id" jdbcType="INTEGER" property="poId" />
		<result column="fc_code" jdbcType="VARCHAR" property="fcCode" />
		<result column="po_code" jdbcType="VARCHAR" property="poCode" />
		<result column="prod_code" jdbcType="VARCHAR" property="prodCode" />
		<result column="customer_code" jdbcType="VARCHAR" property="customerCode" />
		<result column="po_start_date" jdbcType="DATE" property="poStartDate" />
		<result column="po_start_time" jdbcType="TIME" property="poStartTime" />
		<result column="po_end_date" jdbcType="DATE" property="poEndDate" />
		<result column="po_end_time" jdbcType="TIME" property="poEndTime" />
		<result column="po_start_datetime" jdbcType="TIMESTAMP"
			property="poStartDatetime" />
		<result column="po_end_datetime" jdbcType="TIMESTAMP" property="poEndDatetime" />
		<result column="po_count" jdbcType="INTEGER" property="poCount" />
		<result column="po_count_unit" jdbcType="VARCHAR" property="poCountUnit" />
		<result column="po_cust_matcode" jdbcType="VARCHAR" property="poCustMatcode" />
		<result column="po_prod_version" jdbcType="VARCHAR" property="poProdVersion" />
		<result column="line_id" jdbcType="INTEGER" property="lineId" />
		<result column="vsm_id" jdbcType="INTEGER" property="vsmId" />
		<result column="po_status" jdbcType="VARCHAR" property="poStatus" />
		<result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
		<result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
	</resultMap>

	<resultMap type="com.uspring.sdsmesplus.entity.vo.PlanOrderVO"
		id="planOrderVOMap">
		<id column="po_id" jdbcType="INTEGER" property="poId" />
		<result column="fc_code" jdbcType="VARCHAR" property="fcCode" />
		<result column="po_code" jdbcType="VARCHAR" property="poCode" />
		<result column="customer_code" jdbcType="VARCHAR" property="customerCode" />
		<result column="prod_code" jdbcType="VARCHAR" property="prodCode" />
		<result column="po_start_date" jdbcType="DATE" property="poStartDate" />
		<result column="po_start_time" jdbcType="TIME" property="poStartTime" />
		<result column="po_end_date" jdbcType="DATE" property="poEndDate" />
		<result column="po_end_time" jdbcType="TIME" property="poEndTime" />
		<result column="po_start_datetime" jdbcType="TIMESTAMP"
			property="poStartDatetime" />
		<result column="po_end_datetime" jdbcType="TIMESTAMP" property="poEndDatetime" />
		<result column="po_count" jdbcType="INTEGER" property="poCount" />
		<result column="po_count_unit" jdbcType="VARCHAR" property="poCountUnit" />
		<result column="po_cust_matcode" jdbcType="VARCHAR" property="poCustMatcode" />
		<result column="po_prod_version" jdbcType="VARCHAR" property="poProdVersion" />
		<result column="line_id" jdbcType="INTEGER" property="lineId" />
		<result column="vsm_id" jdbcType="INTEGER" property="vsmId" />
		<result column="po_status" jdbcType="VARCHAR" property="poStatus" />
		<result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
		<result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
		<collection property="planOrderProVos"
			ofType="com.uspring.sdsmesplus.entity.vo.PlanOrderProVo">
			<id column="plo" jdbcType="INTEGER" property="plopId" />
			<result column="poc" jdbcType="VARCHAR" property="poCode" />
			<result column="opn" jdbcType="VARCHAR" property="opNo" />
			<result column="opwoek" jdbcType="VARCHAR" property="opWorkstation" />
			<result column="opcntr" jdbcType="VARCHAR" property="opControl" />
			<result column="opdesc" jdbcType="VARCHAR" property="opDesc" />
			<result column="opmanhour" jdbcType="DECIMAL" property="opManHour" />
			<result column="opmanchine" jdbcType="DECIMAL" property="opMachineHour" />
			<collection property="planOpBomPOs"
				ofType="com.uspring.sdsmesplus.entity.po.PlanOpBomPO">
				<id column="plbm_id" jdbcType="INTEGER" property="plbmId" />
				<result column="plop_id" jdbcType="INTEGER" property="plopId" />
				<result column="material_posnr" jdbcType="VARCHAR" property="materialPosnr" />
				<result column="material_code" jdbcType="VARCHAR" property="materialCode" />
				<result column="material_count" jdbcType="INTEGER" property="materialCount" />
				<result column="material_unit" jdbcType="VARCHAR" property="materialUnit" />
				<result column="material_stloc" jdbcType="VARCHAR" property="materialStloc" />
				<result column="material_psa" jdbcType="VARCHAR" property="materialPsa" />
			</collection>
		</collection>
	</resultMap>
	
	<select id="findPlanVOByOrderCode" resultMap="planOrderVOMap">
		select a.*,b.plop_id plo, b.po_code poc, b.op_no opn, b.op_workstation
		  opwoek, b.op_control opcntr, b.op_desc opdesc,
		  b.op_man_hour opmanhour,
		  b.op_machine_hour opmanchine,c.*
		from plan_order a
		  LEFT JOIN
		  plan_order_process b ON a.po_code=b.po_code
		LEFT JOIN plan_op_bom c
		  ON
		  b.plop_id=c.plop_id
		where a.po_code = #{order_code}
		order by a.po_id, b.plop_id, c.plbm_id, a.create_time
	</select>
	
	<!-- 筛选条件查询 -->
	<select id="queryPlanVO" parameterType="map" resultMap="planOrderVOMap">
		select a.*,b.plop_id plo, b.po_code poc, b.op_no opn, b.op_workstation
		  opwoek, b.op_control opcntr, b.op_desc opdesc,
		  b.op_man_hour opmanhour,
		  b.op_machine_hour opmanchine,c.*
		from plan_order a
		  LEFT JOIN
		  plan_order_process b ON a.po_code=b.po_code
		LEFT JOIN plan_op_bom c
		  ON
		  b.plop_id=c.plop_id
		where 1 = 1
		<if test="line_id != null">
			and a.line_id = #{line_id}
		</if>
		<if test="order_code != null">
			and a.po_code = #{order_code}
		</if>
		<if test="starDate != null">
			and a.po_start_datetime &gt;= #{starDate}
		</if>
		<if test="endDate != null">
			and a.po_end_datetime &lt;= #{endDate}
		</if>
		<if test="status != null">
			and a.po_status in
			<foreach collection="statusList" item="sta" index="index"
				open="(" close=")" separator=",">
				#{sta}
			</foreach>
		</if>
		 order by a.po_id, b.plop_id, c.plbm_id, a.create_time
	</select>

</mapper>